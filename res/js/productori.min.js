(function() {
    function n() {
    }
    function t() {
        this.inquiry = function(n) {
            return $.post("bj", n)
        };
    }

    function step1Bind(n) {
        $("#step1 dl li").bind("click",
            function () {
                if ($(this).parents("dl").hasClass("checkbox")) return $(this).toggleClass("selected"),
                    !1;
                if ($(this).hasClass("selected")) return !1;
                $(this).siblings(".selected").removeClass("selected");
                $(this).addClass("selected").parent().parent().parent().addClass("done");
                n.renderProgressbar();
                $(this).parents("dl").index("#step1 dl") + 1 == $("#step1 dl").not(".checkbox").length ? $("#step2").length && n.gotoQuestion($("#step2 .checkbox")) : n.gotoQuestion($(this).parent().parent().parent().next())
            });
    }

    function i() {
        var n = this,
            t = !1;
        this.init = function() {
            $(function() {
                step1Bind(n);
                $("#step2 .checkbox li").bind("click",
                    function() {
                        $(this).hasClass("selected") || $("#property_list dl.checkbox li[data-pid=" + $(this).data("pid") + "]").not($(this)).removeClass("selected");
                        $(this).toggleClass("selected")
                    });
                var t = $("#step3 dl li");
                t.bind("click",
                    function() {
                        $(this).hasClass("selected") || (t.filter(".selected").removeClass("selected"), $(this).addClass("selected"));
                        $("#footer").trigger("click")
                    });
                $("#footer_next").click(function() {
                    var inputnum = $("#inputnum").val();
                    if (typeof(inputnum) == "undefined") {
                        //alert("undefined");
                    } else {
                        if (!inputnum || isNaN(inputnum) || inputnum <= 0 || inputnum > 500000) {
                            tipsPopup("请输入正确的重量(不超过500000克)!");
                            $("#inputnum").focus();
                            return
                        }
                    }

                    for (var r = $("#step1 dl"), i = 0; i < r.length; i++) if (!$(r[i]).hasClass("done") && !$(r[i]).hasClass("checkbox")) {
                        n.gotoQuestion($(r[i]));
                        tipsPopup("请选择条件!");
                        return
                    }

                    t.filter(".selected").length ? $("#footer").trigger("click") : $("body").addClass("step_region_on")
                    $("#footer").trigger("click");
                });
                $("#header .back.step_region").click(function() {
                    $("body").removeClass("step_region_on")
                });
                $(".submit").click(function() {
                    for (var u, f, e, o, i = [], r = $("#step0 dl"), t = 0; t < r.length; t++) if (!$(r[t]).hasClass("done") && !$(r[t]).hasClass("checkbox")) {
                        $("body").removeClass("step_region_on");
                        n.gotoQuestion($(r[t]));
                        return
                    }
                    for (var u, f, e, o, i = [], r = $("#step1 dl"), t = 0; t < r.length; t++) if (!$(r[t]).hasClass("done") && !$(r[t]).hasClass("checkbox")) {
                        $("body").removeClass("step_region_on");
                        n.gotoQuestion($(r[t]));
                        return
                    }
                    if (!$("#step3 dl li").hasClass("selected")) {
                        //alert("请选择地区");
                        return
                    }
                    $("#step1 li.selected").each(function(n, t) {
                        i.push($(t).data("id"))
                    });
                    u = $("#step2 .checkbox");
                    f = {};
                    u.find("li").each(function(n, t) {
                        var r = $(t).data("pid"),
                            e;
                        f[r] || (e = u.find("li.selected[data-pid=" + $(t).data("pid") + "]"), i.push(e.length ? e.data("pid") : ""), f[r] = !0)
                    });

                    if(i[0].indexOf("channel-") == 0) {
                        $("#channelId").attr("value", i[0].substr(8));
                        i[0]="";
                    }

                    var iii = $.grep(i, function(n) {return $.trim(n).length > 0;})

                    e = $("#CaptchaInputText").val();
                    o = $("#CaptchaDeText").val();
                    $("#loading").removeClass("hide");

                    $("#pricerules").attr("value", iii.join(","));
                    $("#cityId").attr("value", $("#step3 li.selected").data("cityid"));
                    $("#num").attr("value", $("#inputnum").val());
                    $("#product").submit();
                })
            })
        };
        this.renderProgressbar = function() {
            var t = $("#property_list").find("dl.done").not(".checkbox").length + 1,
                n = parseInt(t / $("#property_list").find("dl").not(".checkbox").length * 100);
            n >= 100 && (n = 100);
            $("#progressbar_cover").css({
                width: n + "%"
            })
        };
        this.gotoQuestion = function(n) {
            return n.next() == null ? !1 : ($("html, body").animate({
                    scrollTop: n.offset().top - 150 + "px"
                },
                500, "swing"), !0)
        };
    }
    MVC(t, i, n)
})();