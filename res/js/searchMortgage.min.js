jQuery(function(a) {
    var k = a("#loading");
    search = a("#js-search"),
        input = search.find("input"),
        body = a("#body");
    var c = search.find("div.categories-current"),
        e = c.find("span"),
        g = c.data("cid"),
        f = search.find("div.categories-list"),
        B = f.find("span.triangle"),
        C = B.width() / 2,
        d = e.offset().left;
    function A() {
        input.css("padding-left", c.outerWidth());
        B.css("left", d + (e.outerWidth() / 2) - C)
    }
    //c.on("click",
    //    function() {
    //        f.removeClass("hide");
    //        c.addClass("active")
    //    });
    //f.on("click",
    //    function() {
    //        f.addClass("hide");
    //        c.removeClass("active")
    //    });
    //f.on("click", "li",
    //    function() {
    //        var D = a(this);
    //        g = D.data("cid");
    //        e.text(a.trim(D.text()));
    //        D.siblings().removeClass("hide").end().addClass("hide");
    //        A()
    //    });
    var o = body.find("div.searching"),
        p = o.find("div.searching-help"),
        r = o.find("div.searching-list"),
        q = r.find("ul"),
        t = body.find("div.search-reslute"),
        y = t.find("div.search-reslute-list"),
        w = y.find("ul"),
        x = t.find("div.no-search-reslute"),
        v = y.find("div"),
        b = body.data("href"),
        h,
        l = 20;
    search.on("click", "div.clear",
        function() {
            input.val("").trigger("input")
        });
    var m = false,
        s;
    input.on("input",
        function() {
            var D = a(this).val(); ! t.hasClass("hide") && t.addClass("hide");
            o.hasClass("hide") && o.removeClass("hide");
            if (D) {
                s && s.abort();
                s = a.ajax({
                    url: baseurl+"product/searchq",
                    type: "json",
                    method:"post",
                    data: {
                        q: D,
                        cids: [g]
                    },
                    success: function(G) {
                        G = eval("("+G+")");
                        var H = "",
                            F = G.body.rows,
                            J = G.body.rows.length;
                        var ttype = "";
                        if (G.success && J) { ! p.hasClass("hide") && p.addClass("hide");
                            r.hasClass("hide") && r.removeClass("hide");
                            F = G.body.rows;
                            for (var I = 0; I < J; I++) {
                                //console.log(F[I]);
                                var e = F[I];
                                if (e.unit ==="éƒ¨") {
                                    ttype = "phone";
                                }
                                H += "<li><a href=" + baseurl + "product/" + e.id + "/detail?type="+ttype+"&isMortgage=1>" + e.name + "</a></li>"
                            }
                            q.html(H)
                        } else {
                            t.hasClass("hide") && t.removeClass("hide"); ! o.hasClass("hide") && o.addClass("hide");
                            x.hasClass("hide") && x.removeClass("hide"); ! y.hasClass("hide") && y.addClass("hide");
                            q.empty()
                        }
                    }
                })
            } else {
                s && s.abort(); ! r.hasClass("hide") && r.addClass("hide");
                p.hasClass("hide") && p.removeClass("hide")
            }
        }).trigger("input");
    var i = decodeURI(window.location.hash.substring(1));
    if (i) {
        input.val(i).trigger("input")
    }
    var z;
    function n(D, E) {
        D.preventDefault();
        h = E || input.val();
        if (h === "") {
            return
        }
        //location.href("/aaaaa");
    }
    search.on("submit", "form", n);
    a("#js-search-btn").on("click", n);
    var j;
    a(window).lazyLoad({
        load: function(E) {
            if (t.hasClass("hide")) {
                E();
                return
            }
            var D = w.find("li").length / l;
            if (D !== Math.ceil(D)) {
                E();
                return
            }
            k.removeClass("hide");
            j = a.ajax({
                url: "/product/search",
                type: "json",
                data: {
                    Keyword: h,
                    cid: g,
                    PageIndex: D + 1,
                    PageSize: l
                },
                success: function(G) {
                    var H = "",
                        F = G.Data,
                        K = F.length;
                    if (G.Success && K) {
                        for (var I = 0; I < K; I++) {
                            var J = F[I];
                            H += "<li><a href=" + b + J.Id + ">" + J.Name + "</a></li>"
                        }
                        w.append(H);
                        if (K === l) {
                            E()
                        } else {
                            E(true)
                        }
                    }
                    k.addClass("hide")
                }
            })
        }
    });
    v.on("click", "span",
        function() {
            v.addClass("hide")
        })
});