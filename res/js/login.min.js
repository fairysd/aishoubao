(function() {
    function a() {
        var d = this;
        this.doLogin = function(e) {
            $.when(d.model.doLogin(e)).done(function(f) {
                d.view.renderLoginResult(f)
            })
        }
    }
    function b() {
        this.doLogin = function(d) {
            return $.post("dologin", d)
        }
    }
    function c() {
        var d = this;
        this.init = function() {
            if (1) {
                var l = $(".captcha-text"),
                    i = l.find("input"),
                    j = l.find("span"),
                    k = j.text(),
                    n = false,
                    o = null;
                o = function() {
                    n = true;
                    var p = 119,
                        q = setInterval(function() {
                                j.text(p + "s");
                                if (!p--) {
                                    j.text(k);
                                    clearInterval(q);
                                    n = false
                                }
                            },
                            1000)
                };
                j.on("click",
                    function() {
                        if (n) {
                            return
                        }
                        if (!verifyUtils.mobile($("#login-ways-contents li.selected .mobile").val())) {
                            return alert("请填写正确的手机号码")
                        }
                        $.get(baseurl+"sms/sendCode?phoneNumber="+$("#login-ways-contents li.selected .mobile").val(), {
                            },
                            function(p) {
                                p = eval("("+p+")");
                                //console.log(p.success);
                                if (!p.success) {
                                    return alert(p.error)
                                }
                                o()
                            })
                    })
            }
            $("#login-btn").click(function() {
                if (!verifyUtils.mobile($("#login-ways-contents li.selected .mobile").val())) {
                    alert("请填写正确的手机号码")
                } else {
                    var q = $("#way-captcha-content").hasClass("selected");
                    if (q) {
                        captchaTextInputVal = $.trim(i.val());
                        if (captchaTextInputVal.length < 4) {
                            return alert("请输入正确的短信验证码")
                        }
                    } else {}
                    $("#loading").removeClass("hide");
                    d.controller.doLogin({
                        mobile: $("#login-ways-contents li.selected .mobile").val(),
                        password: captchaTextInputVal
                    })
                }
            });
            $("#login-ways-navs li").click(function() {
                if ($(this).hasClass("selected")) {
                    return false
                }
                var q = $(this).siblings(".selected").removeClass("selected").data("wayid");
                var p = $(this).addClass("selected").data("wayid");
                $("#" + q + "-content").removeClass("selected");
                $("#" + p + "-content").addClass("selected");
                $("#" + q + "-extra").removeClass("selected");
                $("#" + p + "-extra").addClass("selected")
            })
        };
        this.renderLoginResult = function(e) {
            $("#loading").addClass("hide");
            e = eval("("+e+")");
            if (e.success) {
                location.href = $("#login-btn").data("redirect");
            } else {
                alert(e.Message)
            }
        }
    }
    MVC(b, c, a)
})();